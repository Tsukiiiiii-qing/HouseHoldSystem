<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.system.mapper.FinanceBudgetMapper">
    
    <resultMap type="FinanceBudget" id="FinanceBudgetResult">
        <result property="budgetId"    column="budget_id"    />
        <result property="userId"    column="user_id"    />
        <result property="userName"  column="user_name"/>
        <result property="yearMonth"    column="year_month"    />
        <result property="amount"    column="amount"    />
        <result property="remark"    column="remark"    />
        <result property="createTime"    column="create_time"    />
        <result property="updateTime"    column="update_time"    />
    </resultMap>

    <sql id="selectFinanceBudgetVo">
        SELECT
            fb.`budget_id`,
            fb.`user_id`,
            u.`nick_name` AS user_name,
            fb.`year_month`,
            fb.`amount`,
            fb.`remark`,
            fb.`create_time`,
            fb.`update_time`
        FROM `finance_budget` fb
                 LEFT JOIN `sys_user` u ON u.`user_id` = fb.`user_id`
    </sql>

    <select id="selectFinanceBudgetList" parameterType="FinanceBudget" resultMap="FinanceBudgetResult">
        <include refid="selectFinanceBudgetVo"/>
        <where>
            <if test="userId != null">AND fb.`user_id` = #{userId}</if>
            <if test="yearMonth != null and yearMonth != ''">AND fb.`year_month` = #{yearMonth}</if>
            <if test="amount != null">AND fb.`amount` = #{amount}</if>
        </where>
    </select>

    <select id="selectFinanceBudgetByBudgetId" parameterType="Long" resultMap="FinanceBudgetResult">
        <include refid="selectFinanceBudgetVo"/>
        WHERE fb.`budget_id` = #{budgetId}
    </select>

<!--    <insert id="insertFinanceBudget" parameterType="FinanceBudget" useGeneratedKeys="true" keyProperty="budgetId">-->
<!--        insert into finance_budget-->
<!--        <trim prefix="(" suffix=")" suffixOverrides=",">-->
<!--            <if test="userId != null">user_id,</if>-->
<!--            <if test="yearMonth != null and yearMonth != ''">year_month,</if>-->
<!--            <if test="amount != null">amount,</if>-->
<!--            <if test="remark != null">remark,</if>-->
<!--            <if test="createTime != null">create_time,</if>-->
<!--            <if test="updateTime != null">update_time,</if>-->
<!--         </trim>-->
<!--        <trim prefix="values (" suffix=")" suffixOverrides=",">-->
<!--            <if test="userId != null">#{userId},</if>-->
<!--            <if test="yearMonth != null and yearMonth != ''">#{yearMonth},</if>-->
<!--            <if test="amount != null">#{amount},</if>-->
<!--            <if test="remark != null">#{remark},</if>-->
<!--            <if test="createTime != null">#{createTime},</if>-->
<!--            <if test="updateTime != null">#{updateTime},</if>-->
<!--         </trim>-->
<!--    </insert>-->

<!--    <update id="updateFinanceBudget" parameterType="FinanceBudget">-->
<!--        update finance_budget-->
<!--        <trim prefix="SET" suffixOverrides=",">-->
<!--            <if test="userId != null">user_id = #{userId},</if>-->
<!--            <if test="yearMonth != null and yearMonth != ''">year_month = #{yearMonth},</if>-->
<!--            <if test="amount != null">amount = #{amount},</if>-->
<!--            <if test="remark != null">remark = #{remark},</if>-->
<!--            <if test="createTime != null">create_time = #{createTime},</if>-->
<!--            <if test="updateTime != null">update_time = #{updateTime},</if>-->
<!--        </trim>-->
<!--        where budget_id = #{budgetId}-->
<!--    </update>-->
    <insert id="insertFinanceBudget" parameterType="FinanceBudget" useGeneratedKeys="true" keyProperty="budgetId">
        INSERT INTO `finance_budget`
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="userId != null">`user_id`,</if>
            <if test="yearMonth != null and yearMonth != ''">`year_month`,</if>
            <if test="amount != null">`amount`,</if>
            <if test="remark != null">`remark`,</if>
            <if test="createTime != null">`create_time`,</if>
            <if test="updateTime != null">`update_time`,</if>
        </trim>
        <trim prefix="VALUES (" suffix=")" suffixOverrides=",">
            <if test="userId != null">#{userId},</if>
            <if test="yearMonth != null and yearMonth != ''">#{yearMonth},</if>
            <if test="amount != null">#{amount},</if>
            <if test="remark != null">#{remark},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="updateTime != null">#{updateTime},</if>
        </trim>
    </insert>

    <update id="updateFinanceBudget" parameterType="FinanceBudget">
        UPDATE `finance_budget`
        <trim prefix="SET" suffixOverrides=",">
            <if test="userId != null">`user_id` = #{userId},</if>
            <if test="yearMonth != null and yearMonth != ''">`year_month` = #{yearMonth},</if>
            <if test="amount != null">`amount` = #{amount},</if>
            <if test="remark != null">`remark` = #{remark},</if>
            <if test="updateTime != null">`update_time` = #{updateTime},</if>
        </trim>
        WHERE `budget_id` = #{budgetId}
    </update>

    <delete id="deleteFinanceBudgetByBudgetId" parameterType="Long">
        DELETE FROM `finance_budget` WHERE `budget_id` = #{budgetId}
    </delete>

    <delete id="deleteFinanceBudgetByBudgetIds" parameterType="String">
        DELETE FROM `finance_budget` WHERE `budget_id` IN
        <foreach item="budgetId" collection="array" open="(" separator="," close=")">
            #{budgetId}
        </foreach>
    </delete>

    <select id="selectAmountByUserAndMonth" resultType="java.math.BigDecimal">
        SELECT `amount`
        FROM `finance_budget`
        WHERE `user_id` = #{userId}
          AND `year_month` = #{ym}
            LIMIT 1
    </select>


    <select id="countByUserAndMonth" resultType="int">
        SELECT COUNT(1) FROM `finance_budget`
        WHERE `user_id` = #{userId} AND `year_month` = #{ym}
    </select>
</mapper>